RP/1/RP0/CPU0:JC22CRS#sh run | inc event mana

event manager environment _email_to ssearch@cisco.com
event manager environment _domainname iplabs.att.com
event manager environment _email_from jc22crs@iplabs.att.com
event manager environment _email_server 192.205.220.50
event manager environment _s2FailDetect_output_log s2FailDetect.log
event manager environment _s2FailDetect_second_diff 30
event manager environment _s2FailDetect_storage_location harddisk:/eem
event manager environment _s2FailDetect_unique_locations 0
event manager directory user policy harddisk:/eem
event manager policy s2FailDetect.tcl username eem-user type user
!
!
!
aaa authorization exec eem-user local
aaa authorization commands eem-user none
aaa authorization eventmanager default local
aaa authorization eventmanager eem-user local
aaa authentication login eem-user local
!
line template eem-user
 authorization exec eem-user
 authorization commands eem-user
!
vty-pool fm 100 110 line-template eem-user







RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#dir harddisk:/eem
Thu Jun 24 23:38:36.635 UTC
Directory of harddisk:/eem
 
2087387232  -rwx  49874       Wed Apr  7 21:27:32 2010  bcc.tcl
2087387392  -rwx  8943        Thu May 13 04:11:11 2010  fab_detect.tcl
2087387488  -rwx  12843       Thu Jun 24 23:05:52 2010  s2FailDetect.tcl <<<<
 
39929724928 bytes total (38927572992 bytes free)
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#term mon
Thu Jun 24 23:38:43.953 UTC
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#


Echoing the syslog the EEM s2FailDetect is triggered by:


RP/1/RP0/CPU0:JC22CRS#run echo "fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_$
Thu Jun 24 23:38:50.708 UTC
RP/1/RP0/CPU0:Jun 24 23:38:50.762 : syslog_dev[83]: syslog_dev: fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_WRAP
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#run echo "fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_$
Thu Jun 24 23:38:53.263 UTC
RP/1/RP0/CPU0:Jun 24 23:38:53.353 : syslog_dev[83]: syslog_dev: fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_WRAP
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#run echo "fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_$
Thu Jun 24 23:38:55.878 UTC
RP/1/RP0/CPU0:Jun 24 23:38:55.976 : syslog_dev[83]: syslog_dev: fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_WRAP
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#run echo "fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_$
Thu Jun 24 23:38:57.347 UTC
RP/1/RP0/CPU0:Jun 24 23:38:57.424 : syslog_dev[83]: syslog_dev: fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_WRAP
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#

Syslogs generated by EEM script and EEM process on router:


RP/1/RP0/CPU0:Jun 24 23:39:34.644 : s2FailDetect.tcl[65821]: EEM s2FailDetect policy detected possible S2 problem. NO COST OUT performed due to _s2FailDetect_ospf_id not set

RP/1/RP0/CPU0:Jun 24 23:39:34.646 : s2FailDetect.tcl[65821]: Sending S2 Fail Detect Detection to ssearch@cisco.com

RP/1/RP0/CPU0:Jun 24 23:39:35.384 : syslog_dev[83]: s2FailDetect.tcl: smtp_send_email: From SMTP server: 550 5.7.1 <ssearch@cisco.com>... Relaying denied. IP name lookup failed [192.168.116.10]

RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#dir harddisk:/eem
Thu Jun 24 23:41:46.583 UTC
                                                                                                                                                          
Directory of harddisk:/eem
 
2087387232  -rwx  49874       Wed Apr  7 21:27:32 2010  bcc.tcl
2087387392  -rwx  8943        Thu May 13 04:11:11 2010  fab_detect.tcl
2087387488  -rwx  12843       Thu Jun 24 23:05:52 2010  s2FailDetect.tcl <<<
2087387584  -rwx  58770       Thu Jun 24 23:39:35 2010  s2FailDetect.log <<<
 
39929724928 bytes total (38927511552 bytes free)
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#
RP/1/RP0/CPU0:JC22CRS#


Snippet of details from the s2FailDetect output log:


RP/1/RP0/CPU0:JC22CRS#more harddisk:/eem/s2FailDetect.log
Thu Jun 24 23:43:00.377 UTC
*Timestamp = 23:38:58 EDT Thu Jun 24 2010
Node: JC22CRS
 
 
Final Syslog Trigger:
RP/1/RP0/CPU0: syslog_dev[83]: syslog_dev: fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_WRAP
 
 
 
Location Extracted: RP/1/RP0/CPU0
 
 
command output: show controllers fabricq health
  Location:  0/3/CPU0
  Asic Instance:   0
  Fabric Destination Address:    12
  Cpuctrl EC: 00000000
  SN8 Frame: 0x000001         SN8 CRC: 00000000
 
  Fabric Interface Top level EC: 0
  Block 0 EC: 00000000        Block 1 EC: 00000000
  Block 2 EC: 00000000        Block 3 EC: 00000000
  Block 4 EC: 00000000        Block 5 EC: 00000000
  Block 6 EC: 00000000        Block 7 EC: 00000000
 
  Ingressq Interface Top level EC: 00000000
  BP Cluster 0 EC: 00000000   BP Cluster 1 EC: 00000000
  BP Cluster 2 EC: 00000000   BP Cluster 3 EC: 00000000
  BP Cluster 4 EC: 00000000   BP Cluster 5 EC: 00000000
  BP Cluster 6 EC: 00000000   BP Cluster 7 EC: 00000000
  BP Cluster 8 EC: 00000000   BP Cluster 9 EC: 00000000
  BP Cluster 10 EC: 00000000  BP Cluster 11 EC: 00000000
  BP Cluster 12 EC: 00000000  BP Cluster 13 EC: 00000000
  BP Cluster 14 EC: 00000000  BP Cluster 15 EC: 00000000
  BM EC: 00000000

<snip>

  FCRAM 3 First error: 0xffb47d
  Channel 4 EC: 00000000      FCRAM 4 EC: 00000000
  FCRAM 4 First error: 0x9e9b8b
  Channel 5 EC: 00000000      FCRAM 5 EC: 00000000
  FCRAM 5 First error: 0x3bf79d
  Channel 6 EC: 00000000      FCRAM 6 EC: 00000000
  FCRAM 6 First error: 0x5eca6d
  Channel 7 EC: 00000000      FCRAM 7 EC: 00000000
  FCRAM 7 First error: 0x374480
RP/1/RP0/CPU0:JC22CRS(admin)#
 
 
                                                                                                                                                          
command output: show controllers fabric plane all
  Flags: P - plane admin down,       p - plane oper down
         C - card admin down,        c - card  oper down
         L - link port admin down,   l - linkport oper down
         A - asic admin down,        a - asic oper down
         B - bundle port admin Down, b - bundle port oper down
         I - bundle admin down,      i - bundle oper down
         N - node admin down,        n - node down
         o - other end of link down  d - data down
         f - failed component downstream
         m - plane multicast down,   s - link port permanently shutdown
         t - no barrier input
 
 Plane  Admin   Oper
 Id     State   State
 --------------------
 0      UP      UP
 1      UP      UP
 2      UP      UP
 3      UP      UP
 4      UP      UP
 5      UP      UP
 6      UP      UP
 7      UP      UP
RP/1/RP0/CPU0:JC22CRS(admin)#
 
 
 
command output: show platform
Node            Type            PLIM            State           Config State
-----------------------------------------------------------------------------
0/3/SP          MSC(SP)         N/A             IOS XR RUN      PWR,NSHUT,MON
0/3/CPU0        MSC             1OC768-POS      IOS XR RUN      PWR,NSHUT,MON
0/5/SP          MSC(SP)         N/A             IOS XR RUN      PWR,NSHUT,MON
0/5/CPU0        MSC             8-10GbE         IOS XR RUN      PWR,NSHUT,MON
0/6/SP          MSC(SP)         N/A             IOS XR RUN      PWR,NSHUT,MON
0/6/CPU0        MSC             Jacket Card     IOS XR RUN      PWR,NSHUT,MON
0/6/0           MSC(SPA)        1x10GE          OK              PWR,NSHUT,MON

<snip>

F0/AM1/SP       ALARM(SP)       N/A             IOS XR RUN      PWR,NSHUT,MON
F0/LM0/SP       FCC-LED(SP)     N/A             IOS XR RUN      PWR,NSHUT,MON
F0/LM1/SP       FCC-LED(SP)     N/A             IOS XR RUN      PWR,NSHUT,MON
RP/1/RP0/CPU0:JC22CRS(admin)#
 
 
 
 
locations before sort: RP/1/RP0/CPU0
unique_locations: RP/1/RP0/CPU0
 
EMAIL DATA BELOW SENT TO: ssearch@cisco.com
 
Mailservername: 192.205.220.50
From: jc22crs@iplabs.att.com
To: ssearch@cisco.com
Cc:
Subject: **Node JC22CRS S2 Fail Detection**
 
The JC22CRS node experienced the following syslog:
RP/1/RP0/CPU0: syslog_dev[83]: syslog_dev: fabricq_mgr[136]: %FABRIC-FABRICQ-3-RESET : Reseting Fabricq ASIC Device 0. Reason: UC_PSN_WRAP
 
 
 
EEM s2FailDetect policy detected possible S2 problem. NO COST OUT performed due to _s2FailDetect_ospf_id not set
RP/1/RP0/CPU0:JC22CRS#
